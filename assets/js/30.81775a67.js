(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{446:function(s,a,t){"use strict";t.r(a);var n=t(9),r=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"主从复制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#主从复制"}},[s._v("#")]),s._v(" 主从复制")]),s._v(" "),a("h2",{attrs:{id:"_1-主从复制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-主从复制"}},[s._v("#")]),s._v(" 1. 主从复制")]),s._v(" "),a("p",[s._v("主从复制是一个简单的数据库同步备份的集群技术")]),s._v(" "),a("p",[s._v("在数据库集群中要明确知道谁是主服务器，主服务器只有一台\n从服务器要知道自己的数据源也就是知道自己的主服务器是谁\n--master 用来确定主服务器，--slave 和--source 来控制从服务器\nmasterslave")]),s._v(" "),a("h3",{attrs:{id:"_1-1-主服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-主服务器"}},[s._v("#")]),s._v(" 1.1 主服务器")]),s._v(" "),a("p",[s._v("master.conf")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("dbpath"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("E")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\\ms\\master\nport"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\nmaster"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("master.bat")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("mongod "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("config master"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_1-2-从服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-从服务器"}},[s._v("#")]),s._v(" 1.2 从服务器")]),s._v(" "),a("p",[s._v("slave.conf")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("dbpath"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("E")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\\p\\slave\nport"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1001")]),s._v("\nslave"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nsource"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("slave.bat")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("mongod "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("config slave"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf\nrs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("slaveOk")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"_1-3-主从复制的其它设置项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-主从复制的其它设置项"}},[s._v("#")]),s._v(" 1.3 主从复制的其它设置项")]),s._v(" "),a("ul",[a("li",[s._v("-only 从节点-> 指定复制某个数据库默认是复制全部数据库")]),s._v(" "),a("li",[s._v("-slavedelay 从节点-> 设置主数据库同步数据的延迟(单位是秒)")]),s._v(" "),a("li",[s._v("-fastsync 从节点-> 以主数据库的节点快照为节点启动从数据库")]),s._v(" "),a("li",[s._v("-autoresync 从节点->如果不同步则重新同步数据库")]),s._v(" "),a("li",[s._v("-oplogSize 主节点->设置 oplog 的大小(主节点操作记录存储到 local 的 oplog 中)")])]),s._v(" "),a("h3",{attrs:{id:"_1-4-利用-shell-动态添加和删除主节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-利用-shell-动态添加和删除主节点"}},[s._v("#")]),s._v(" 1.4 利用 shell 动态添加和删除主节点")]),s._v(" "),a("p",[s._v("登录从服务器")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("use local"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nshow collections"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ndb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sources"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('//{ "host" : "127.0.0.1:8000", "source" : "main", "syncedTo" : Timestamp(1524728329, 1) }')]),s._v("\ndb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sources"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("insert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'127.0.0.1:8000'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//挂载主节点")]),s._v("\ndb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sources"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("remove")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'127.0.0.1:8000'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//删除已经挂载的主节点")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h2",{attrs:{id:"_2-副本集"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-副本集"}},[s._v("#")]),s._v(" 2. 副本集")]),s._v(" "),a("ul",[a("li",[s._v("MongoDB 复制是将数据同步在多个服务器的过程。")]),s._v(" "),a("li",[s._v("复制提供了数据的冗余备份，并在多个服务器上存储数据副本，提高了数据的可用性， 并可以保证数据的安全性。")]),s._v(" "),a("li",[s._v("复制还允许您从硬件故障和服务中断中恢复数据。")])]),s._v(" "),a("h3",{attrs:{id:"_2-1-mongodb-复制原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-mongodb-复制原理"}},[s._v("#")]),s._v(" 2.1 MongoDB 复制原理")]),s._v(" "),a("ul",[a("li",[s._v("mongodb 的复制至少需要两个节点。其中一个是主节点，负责处理客户端请求，其余的都是从节点，负责复制主节点上的数据。")]),s._v(" "),a("li",[s._v("mongodb 各个节点常见的搭配方式为：一主一从、一主多从。")]),s._v(" "),a("li",[s._v("主节点记录在其上的所有操作 oplog，从节点定期轮询主节点获取这些操作，然后对自己的数据副本执行这些操作，从而保证从节点的数据与主节点一致。")]),s._v(" "),a("li",[s._v("replication")])]),s._v(" "),a("h3",{attrs:{id:"_2-1-流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-流程"}},[s._v("#")]),s._v(" 2.1 流程")]),s._v(" "),a("ul",[a("li",[s._v("一台活跃服务器和二个备份服务器")]),s._v(" "),a("li",[s._v("当活跃服务器出现故障，这时集群根据权重算法推选出出活跃服务器")]),s._v(" "),a("li",[s._v("当原来的主服务器恢复后又会变成从服务器")])]),s._v(" "),a("h3",{attrs:{id:"_2-2-配置副本集"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-配置副本集"}},[s._v("#")]),s._v(" 2.2 配置副本集")]),s._v(" "),a("p",[s._v("A 服务器")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("dbpath"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("E")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\\repl\\repl1\nport"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2001")]),s._v("\nreplSet"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("group\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("B 服务器")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("dbpath"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("E")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\\repl\\repl2\nport"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2002")]),s._v("\nreplSet"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("group\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("C 服务器")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("dbpath"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("E")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\\repl\\repl3\nport"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2003")]),s._v("\nreplSet"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("group\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"_2-3-初始化副本集"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-初始化副本集"}},[s._v("#")]),s._v(" 2.3 初始化副本集")]),s._v(" "),a("ul",[a("li",[s._v("rs.initiate() 启动一个新的副本集")]),s._v(" "),a("li",[s._v("rs.conf() 查看副本集的配置")]),s._v(" "),a("li",[s._v("rs.status() 命令")])]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("use admin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" conf"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"\\_id"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"group"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"members"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"_id"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"host"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1:2001"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"_id"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"host"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1:2002"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"_id"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"host"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1:2003"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nrs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("initiate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nrs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h3",{attrs:{id:"_2-4-高级参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-高级参数"}},[s._v("#")]),s._v(" 2.4 高级参数")]),s._v(" "),a("ul",[a("li",[s._v("standard 常规节点 参与投票有可能成为活跃节点")]),s._v(" "),a("li",[s._v("passive 副本节点 参与投票，但不能成为活跃节点")]),s._v(" "),a("li",[s._v("arbiter 仲裁节点 只参与投票，不复制节点，也不能成为活跃节点")]),s._v(" "),a("li",[s._v("priority 0 到 1000 之间，0 代表是副本节点，1 到 1000 是常规节点")]),s._v(" "),a("li",[s._v("arbiterOnly:true 仲裁节点")])]),s._v(" "),a("h3",{attrs:{id:"_2-5-读写分离操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-读写分离操作"}},[s._v("#")]),s._v(" 2.5 读写分离操作")]),s._v(" "),a("p",[s._v("一般情况下作为副本节点是不能进行数据库操作的，但是在读取密集的系统中读写分离是必要的")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("rs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("slaveOk")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_2-6-oplog"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-oplog"}},[s._v("#")]),s._v(" 2.6 Oplog")]),s._v(" "),a("p",[s._v("它被存储在本地数据库 local 中，会记录每一个操作。 如果希望在故障恢复的时候尽可能更多，可以把这个 size 设置的大一点")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("oplogSize "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v("\nuse local"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ndb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("oplog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("limit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h2",{attrs:{id:"_3-分片"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-分片"}},[s._v("#")]),s._v(" 3. 分片")]),s._v(" "),a("p",[s._v("在 Mongodb 里面存在另一种集群，就是分片技术,可以满足 MongoDB 数据量大量增长的需求。 当 MongoDB 存储海量的数据时，一台机器可能不足以存储数据，也可能不足以提供可接受的读写吞吐量。这时，我们就可以通过在多台机器上分割数据，使得数据库系统能存储和处理更多的数据。")]),s._v(" "),a("h3",{attrs:{id:"_3-1-分片架构图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-分片架构图"}},[s._v("#")]),s._v(" 3.1 分片架构图")]),s._v(" "),a("p",[s._v("sharding")]),s._v(" "),a("h3",{attrs:{id:"_3-2-片键"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-片键"}},[s._v("#")]),s._v(" 3.2 片键")]),s._v(" "),a("p",[s._v("路由根据片键把不同的文档保存到不同的分片中")]),s._v(" "),a("h3",{attrs:{id:"_3-3-分片的应用场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-分片的应用场景"}},[s._v("#")]),s._v(" 3.3 分片的应用场景")]),s._v(" "),a("ul",[a("li",[s._v("单台机器无法存储")]),s._v(" "),a("li",[s._v("单台机器已经不能满足高并发操作")]),s._v(" "),a("li",[s._v("想把尽可能多的数据存放到内存中提高性能")])]),s._v(" "),a("h3",{attrs:{id:"_3-4-配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-配置"}},[s._v("#")]),s._v(" 3.4 配置")]),s._v(" "),a("h4",{attrs:{id:"_3-4-1-创建-sharding-副本集"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-1-创建-sharding-副本集"}},[s._v("#")]),s._v(" 3.4.1 创建 Sharding 副本集")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" E:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("repl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("db2001\nmongod "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2001")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--dbpath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/db2001 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--shardsvr")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--replSet")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("shard1\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" E:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("repl/db2002\nmongod "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2002")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--dbpath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/db2002 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--shardsvr")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--replSet")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("shard1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mongo localhost:2001")]),s._v("\nrs.initiate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("_id: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'shard1'")]),s._v(", members: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("_id: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", host: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost:2001'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("_id: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", host: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost:2002'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nrs.isMaster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看主从关系")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" E:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("repl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("db2003\nmongod "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2003")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--dbpath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("E:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("repl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("db2003 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--shardsvr")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--replSet")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("shard2\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" E:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("repl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("db2004\nmongod "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2004")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--dbpath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("E:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("repl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("db2004 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--shardsvr")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--replSet")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("shard2\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mongo localhost:2003")]),s._v("\nrs.initiate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("_id: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'shard2'")]),s._v(", members: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("_id: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", host: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost:2003'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("_id: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", host: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost:2004'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nrs.isMaster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看主从关系")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h4",{attrs:{id:"_3-4-2-创建一个配置服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-2-创建一个配置服务器"}},[s._v("#")]),s._v(" 3.4.2 创建一个配置服务器")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" E:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("repl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("db2005\nmongod "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2005")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--dbpath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("E:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("repl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("db2005 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--shardsvr")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--replSet")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("config\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" E:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("repl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("db2006\nmongod "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2006")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--dbpath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("E:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("repl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("db2006 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--shardsvr")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--replSet")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("config\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mongo localhost:2005")]),s._v("\nrs.initiate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("_id: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'config'")]),s._v(", members: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("_id: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", host: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost:2005'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("_id: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", host: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost:2006'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nrs.isMaster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看主从关系")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h4",{attrs:{id:"_3-4-2-创建路由服务器-并且连接配置服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-2-创建路由服务器-并且连接配置服务器"}},[s._v("#")]),s._v(" 3.4.2 创建路由服务器，并且连接配置服务器")]),s._v(" "),a("p",[s._v("路由器调用 mongos 命令")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("mongos "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2006")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--configdb")]),s._v(" config/localhost:2005,localhost:2006\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"_3-4-3-添加分片数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-3-添加分片数据库"}},[s._v("#")]),s._v(" 3.4.3 添加分片数据库")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("mongo localhost:2006\nuse admin\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" db.runCommand"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" addshard: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'shard1/localhost:2001,localhost:2002'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" db.runCommand"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" addshard: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'shard2/localhost:2003,localhost:2004'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h4",{attrs:{id:"_3-4-5-在路由服务器打开数据分片功能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-5-在路由服务器打开数据分片功能"}},[s._v("#")]),s._v(" 3.4.5 在路由服务器打开数据分片功能")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("use admin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" db.runCommand"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" enablesharding: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'school'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" db.runCommand"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" shardcollection: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'school.students'")]),s._v(", key: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("name: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h2",{attrs:{id:"_4-参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-参考"}},[s._v("#")]),s._v(" 4. 参考")]),s._v(" "),a("ul",[a("li",[s._v("configuration-options")])])])}),[],!1,null,null,null);a.default=r.exports}}]);