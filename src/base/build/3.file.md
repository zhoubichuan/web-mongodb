---
lang: zh-CN
sidebarDepth: 2
meta:
  - name: description
    content: 个人总结的vuepress学习技术文档-语法
  - name: keywords
    content: vuepress,最新技术文档,vuepress语法,markdown语法
---

# 三.启动与连接

## 1.

```js
/* 
  mongoose.js ：建立数据库连接
 */
var mongoose = require("mongoose"); // 引入 mongoose
var url = "mongodb://localhost:27017/mytest"; // 本地数据库地址
mongoose.connect(url);

// connect() 返回一个状态待定（pending）的连接，可以用来判断连接成功或失败
var db = mongoose.connection;
db.on("error", console.error.bind(console, "connection error:"));
db.once("open", function () {
  console.log("Successful connection to " + url);
});
```

```js
/*
  mongoose.js ：建立数据库连接用 mongoose.Schema 插入数据
 */
var Schema = mongoose.Schema; //schema 都会映射到一个 MongoDB collection

let user = {
  name: String,
};

var userSchema = Schema(user);
var User = mongoose.model("User", userSchema); //将schema编译为model构造函数

var newUser = new User({ name: "yyyyyyyyyyyy" }); // Mongoose 会自动找到名称是 model 名字复数形式的 collection
newUser.save();
```
## 多个连接
到目前为止，我们已经看到了如何使用MongoDB的默认连接。有时我们可能需要mongo打开多个连接，每个有不同的读/写设置，或者只是对不同的数据库为例。在这些情况下,我们可以利用mongoose.createConnection()接受已经讨论过的所有参数，并返回一个新的连接。

```js
var conn = mongoose.createConnection('mongodb://[username:password@]host1[:port1][,host2[:port2],...[,hostN[:portN]]][/[database][?options]
```
## 连接池

每个连接，无论是用 mongoose.connect 还是 mongoose.createConnection 创建都用一个默认大小为 5 的内置可配置连接池备份。使用的连接选项调节其大小，

```js
// single server
var uri = "mongodb://localhost/test";
mongoose.createConnection(uri, { server: { poolSize: 4 } });

// for a replica set
mongoose.createConnection(uri, { replset: { poolSize: 4 } });

// passing the option in the URI works with single or replica sets
var uri = "mongodb://localhost/test?poolSize=4";
mongoose.createConnection(uri);
```
