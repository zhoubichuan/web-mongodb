<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>基础 2 | MongoDB学习笔记</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="个人总结的vuepress学习技术文档-语法">
    <meta name="keywords" content="vuepress,最新技术文档,vuepress语法,markdown语法">
    
    <link rel="preload" href="/web-mongodb/assets/css/0.styles.1cc2edb7.css" as="style"><link rel="preload" href="/web-mongodb/assets/js/app.d4f4e3a2.js" as="script"><link rel="preload" href="/web-mongodb/assets/js/2.5fc4c12c.js" as="script"><link rel="preload" href="/web-mongodb/assets/js/11.b75e87f0.js" as="script"><link rel="preload" href="/web-mongodb/assets/js/3.7af90dcf.js" as="script"><link rel="prefetch" href="/web-mongodb/assets/js/10.d932f0de.js"><link rel="prefetch" href="/web-mongodb/assets/js/12.58a4bfe0.js"><link rel="prefetch" href="/web-mongodb/assets/js/13.e2f8b744.js"><link rel="prefetch" href="/web-mongodb/assets/js/14.c581e6a6.js"><link rel="prefetch" href="/web-mongodb/assets/js/15.185e3cbd.js"><link rel="prefetch" href="/web-mongodb/assets/js/16.171d39c0.js"><link rel="prefetch" href="/web-mongodb/assets/js/17.3daed6ff.js"><link rel="prefetch" href="/web-mongodb/assets/js/18.8955318f.js"><link rel="prefetch" href="/web-mongodb/assets/js/19.b601147f.js"><link rel="prefetch" href="/web-mongodb/assets/js/20.7902bebd.js"><link rel="prefetch" href="/web-mongodb/assets/js/21.9eb21f0b.js"><link rel="prefetch" href="/web-mongodb/assets/js/22.6b10cbc7.js"><link rel="prefetch" href="/web-mongodb/assets/js/23.f608a044.js"><link rel="prefetch" href="/web-mongodb/assets/js/24.77068dd5.js"><link rel="prefetch" href="/web-mongodb/assets/js/25.a271c0b6.js"><link rel="prefetch" href="/web-mongodb/assets/js/26.c0c352b9.js"><link rel="prefetch" href="/web-mongodb/assets/js/27.6dbdad15.js"><link rel="prefetch" href="/web-mongodb/assets/js/28.4dcb3c17.js"><link rel="prefetch" href="/web-mongodb/assets/js/29.cd7e256d.js"><link rel="prefetch" href="/web-mongodb/assets/js/30.a96e47b8.js"><link rel="prefetch" href="/web-mongodb/assets/js/31.ed8223ac.js"><link rel="prefetch" href="/web-mongodb/assets/js/32.e7d7f357.js"><link rel="prefetch" href="/web-mongodb/assets/js/33.49c3f651.js"><link rel="prefetch" href="/web-mongodb/assets/js/34.77dc45e1.js"><link rel="prefetch" href="/web-mongodb/assets/js/35.f2cff53d.js"><link rel="prefetch" href="/web-mongodb/assets/js/36.b70d1aaa.js"><link rel="prefetch" href="/web-mongodb/assets/js/37.173f9c07.js"><link rel="prefetch" href="/web-mongodb/assets/js/38.7cc05dc5.js"><link rel="prefetch" href="/web-mongodb/assets/js/39.af8cef60.js"><link rel="prefetch" href="/web-mongodb/assets/js/4.7605f29e.js"><link rel="prefetch" href="/web-mongodb/assets/js/40.3ddb18c6.js"><link rel="prefetch" href="/web-mongodb/assets/js/41.bdd3c57f.js"><link rel="prefetch" href="/web-mongodb/assets/js/42.38b8c316.js"><link rel="prefetch" href="/web-mongodb/assets/js/5.ed28116d.js"><link rel="prefetch" href="/web-mongodb/assets/js/6.72a169c2.js"><link rel="prefetch" href="/web-mongodb/assets/js/7.4155cfd8.js"><link rel="prefetch" href="/web-mongodb/assets/js/8.9db36fde.js"><link rel="prefetch" href="/web-mongodb/assets/js/9.34460e32.js">
    <link rel="stylesheet" href="/web-mongodb/assets/css/0.styles.1cc2edb7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/web-mongodb/" class="home-link router-link-active"><!----> <span class="site-name">MongoDB学习笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础知识" class="dropdown-title"><span class="title">基础知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="基础知识" class="mobile-dropdown-title"><span class="title">基础知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web-mongodb/base/build/1.config.html" class="nav-link">
    1.MongoDB实践指南
  </a></li><li class="dropdown-item"><!----> <a href="/web-mongodb/base/practice/1.MongoDB.html" class="nav-link">
    2.MongoDB相关实践
  </a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="高级知识" class="dropdown-title"><span class="title">高级知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="高级知识" class="mobile-dropdown-title"><span class="title">高级知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web-mongodb/senior/use/1.recursionAndDynamics.html" class="nav-link">
    1.组件精讲
  </a></li><li class="dropdown-item"><!----> <a href="/web-mongodb/senior/typeScript/inde.html" class="nav-link">
    2.TypeScript
  </a></li></ul></div></div> <a href="https://github.com/zhoubichuan/web-mongodb" target="_blank" rel="noopener noreferrer" class="repo-link">
      查看源码
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础知识" class="dropdown-title"><span class="title">基础知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="基础知识" class="mobile-dropdown-title"><span class="title">基础知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web-mongodb/base/build/1.config.html" class="nav-link">
    1.MongoDB实践指南
  </a></li><li class="dropdown-item"><!----> <a href="/web-mongodb/base/practice/1.MongoDB.html" class="nav-link">
    2.MongoDB相关实践
  </a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="高级知识" class="dropdown-title"><span class="title">高级知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="高级知识" class="mobile-dropdown-title"><span class="title">高级知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web-mongodb/senior/use/1.recursionAndDynamics.html" class="nav-link">
    1.组件精讲
  </a></li><li class="dropdown-item"><!----> <a href="/web-mongodb/senior/typeScript/inde.html" class="nav-link">
    2.TypeScript
  </a></li></ul></div></div> <a href="https://github.com/zhoubichuan/web-mongodb" target="_blank" rel="noopener noreferrer" class="repo-link">
      查看源码
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/web-mongodb/base/build/1.config.html" class="sidebar-link">1.什么是 MongoDB</a></li><li><a href="/web-mongodb/base/build/2.webpack.html" class="sidebar-link">二.MongoDB 安装</a></li><li><a href="/web-mongodb/base/build/3.file.html" class="sidebar-link">3.MongoDB 启动与连接</a></li><li><a href="/web-mongodb/base/build/4.single.html" class="sidebar-link">4.MongoDB 基本概念</a></li><li><a href="/web-mongodb/base/build/5.page.html" class="sidebar-link">5.数据库操作</a></li><li><a href="/web-mongodb/base/build/7.module.html" class="sidebar-link">6.集合操作</a></li><li><a href="/web-mongodb/base/build/8.project.html" class="sidebar-link">7.插入文档</a></li><li><a href="/web-mongodb/base/build/9.utils.html" class="sidebar-link">更新文档</a></li><li><a href="/web-mongodb/base/build/10.ui.html" class="sidebar-link">基础知识</a></li><li><a href="/web-mongodb/base/build/11.data.html" aria-current="page" class="active sidebar-link">基础 2</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web-mongodb/base/build/11.data.html#_1-通过配置项启动数据库" class="sidebar-link">1. 通过配置项启动数据库</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web-mongodb/base/build/11.data.html#_1-1-mongo-conf" class="sidebar-link">1.1 mongo.conf</a></li><li class="sidebar-sub-header"><a href="/web-mongodb/base/build/11.data.html#_1-2-启动服务器" class="sidebar-link">1.2 启动服务器</a></li><li class="sidebar-sub-header"><a href="/web-mongodb/base/build/11.data.html#_1-3-启动客户端" class="sidebar-link">1.3 启动客户端</a></li></ul></li><li class="sidebar-sub-header"><a href="/web-mongodb/base/build/11.data.html#_2-导入导出数据" class="sidebar-link">2. 导入导出数据</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web-mongodb/base/build/11.data.html#_2-1-准备数据" class="sidebar-link">2.1 准备数据</a></li><li class="sidebar-sub-header"><a href="/web-mongodb/base/build/11.data.html#_2-2-备份记录" class="sidebar-link">2.2 备份记录</a></li><li class="sidebar-sub-header"><a href="/web-mongodb/base/build/11.data.html#_2-3-删除记录" class="sidebar-link">2.3 删除记录</a></li><li class="sidebar-sub-header"><a href="/web-mongodb/base/build/11.data.html#_2-4-导入记录" class="sidebar-link">2.4 导入记录</a></li></ul></li><li class="sidebar-sub-header"><a href="/web-mongodb/base/build/11.data.html#_3-备份与恢复" class="sidebar-link">3. 备份与恢复</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web-mongodb/base/build/11.data.html#_3-1-mongodump" class="sidebar-link">3.1 mongodump</a></li><li class="sidebar-sub-header"><a href="/web-mongodb/base/build/11.data.html#_3-2-mongorestore" class="sidebar-link">3.2 mongorestore</a></li></ul></li><li class="sidebar-sub-header"><a href="/web-mongodb/base/build/11.data.html#_4-直接拷贝数据" class="sidebar-link">4. 直接拷贝数据</a></li><li class="sidebar-sub-header"><a href="/web-mongodb/base/build/11.data.html#_5-锁定和解锁数据库" class="sidebar-link">5. 锁定和解锁数据库</a></li><li class="sidebar-sub-header"><a href="/web-mongodb/base/build/11.data.html#_6-安全措施" class="sidebar-link">6. 安全措施</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web-mongodb/base/build/11.data.html#_6-1-用户管理" class="sidebar-link">6.1 用户管理</a></li></ul></li><li class="sidebar-sub-header"><a href="/web-mongodb/base/build/11.data.html#_7-数据库高级命令" class="sidebar-link">7. 数据库高级命令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web-mongodb/base/build/11.data.html#_7-1-准备数据" class="sidebar-link">7.1 准备数据</a></li><li class="sidebar-sub-header"><a href="/web-mongodb/base/build/11.data.html#_7-2-count" class="sidebar-link">7.2 count</a></li><li class="sidebar-sub-header"><a href="/web-mongodb/base/build/11.data.html#_7-2-查找不重复的值-distinct" class="sidebar-link">7.2 查找不重复的值 distinct</a></li><li class="sidebar-sub-header"><a href="/web-mongodb/base/build/11.data.html#_7-3-group-分组" class="sidebar-link">7.3 group 分组</a></li><li class="sidebar-sub-header"><a href="/web-mongodb/base/build/11.data.html#_7-4-删除集合" class="sidebar-link">7.4 删除集合</a></li><li class="sidebar-sub-header"><a href="/web-mongodb/base/build/11.data.html#_7-5-runcommand-常用命令" class="sidebar-link">7.5 runCommand 常用命令</a></li></ul></li><li class="sidebar-sub-header"><a href="/web-mongodb/base/build/11.data.html#_8-什么固定集合" class="sidebar-link">8. 什么固定集合</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web-mongodb/base/build/11.data.html#_8-1-特性" class="sidebar-link">8.1 特性</a></li><li class="sidebar-sub-header"><a href="/web-mongodb/base/build/11.data.html#_8-2-创建固定集合" class="sidebar-link">8.2 创建固定集合</a></li><li class="sidebar-sub-header"><a href="/web-mongodb/base/build/11.data.html#_8-3-非固定集合转为固定集合" class="sidebar-link">8.3 非固定集合转为固定集合</a></li></ul></li><li class="sidebar-sub-header"><a href="/web-mongodb/base/build/11.data.html#_9-gridfs" class="sidebar-link">9. gridfs</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web-mongodb/base/build/11.data.html#_9-1-上传一个文件" class="sidebar-link">9.1 上传一个文件</a></li><li class="sidebar-sub-header"><a href="/web-mongodb/base/build/11.data.html#_9-2-获取并下载文件" class="sidebar-link">9.2 获取并下载文件</a></li><li class="sidebar-sub-header"><a href="/web-mongodb/base/build/11.data.html#_9-3-查看所有文件" class="sidebar-link">9.3 查看所有文件</a></li><li class="sidebar-sub-header"><a href="/web-mongodb/base/build/11.data.html#_9-4-删除文件" class="sidebar-link">9.4 删除文件</a></li><li class="sidebar-sub-header"><a href="/web-mongodb/base/build/11.data.html#_9-5-eval-服务器端脚本" class="sidebar-link">9.5 eval 服务器端脚本</a></li></ul></li></ul></li><li><a href="/web-mongodb/base/build/12.skill.html" class="sidebar-link">基础3</a></li><li><a href="/web-mongodb/base/build/13.com.html" class="sidebar-link">基础4</a></li><li><a href="/web-mongodb/base/build/14.data.html" class="sidebar-link">基础5</a></li><li><a href="/web-mongodb/base/build/15.api.html" class="sidebar-link">/base/build/15.api.html</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="基础-2"><a href="#基础-2" class="header-anchor">#</a> 基础 2</h1> <h2 id="_1-通过配置项启动数据库"><a href="#_1-通过配置项启动数据库" class="header-anchor">#</a> 1. 通过配置项启动数据库</h2> <table><thead><tr><th>参数</th> <th>含义</th></tr></thead> <tbody><tr><td>--dbpath</td> <td>指定数据库文件的目录</td></tr> <tr><td>--port</td> <td>端口 默认是 27017 28017</td></tr> <tr><td>--fork</td> <td>以后台守护的方式进行启动</td></tr> <tr><td>--logpath</td> <td>指定日志文件输出路径</td></tr> <tr><td>--config</td> <td>指定一个配置文件</td></tr> <tr><td>--auth</td> <td>以安全方式启动数据库，默认不验证</td></tr></tbody></table> <h3 id="_1-1-mongo-conf"><a href="#_1-1-mongo-conf" class="header-anchor">#</a> 1.1 mongo.conf</h3> <ul><li>dbpath=E:\mongo\data</li> <li>logpath=E:\mongo\log</li> <li>port=50000</li></ul> <h3 id="_1-2-启动服务器"><a href="#_1-2-启动服务器" class="header-anchor">#</a> 1.2 启动服务器</h3> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>mongod --config mongo.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_1-3-启动客户端"><a href="#_1-3-启动客户端" class="header-anchor">#</a> 1.3 启动客户端</h3> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>mongo --port <span class="token number">50000</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="_2-导入导出数据"><a href="#_2-导入导出数据" class="header-anchor">#</a> 2. 导入导出数据</h2> <p>这命令是保存成了文件格式</p> <ul><li>mongoimport 导出数据</li> <li>mongoexport 导入数据</li></ul> <table><thead><tr><th>参数</th> <th>含义</th></tr></thead> <tbody><tr><td>-h [ --host ]</td> <td>连接的数据库</td></tr> <tr><td>--port</td> <td>端口号</td></tr> <tr><td>-u</td> <td>用户名</td></tr> <tr><td>-p</td> <td>密码</td></tr> <tr><td>-d</td> <td>导出的数据库</td></tr> <tr><td>-d</td> <td>导出的数据库</td></tr> <tr><td>-c</td> <td>指定导出的集合</td></tr> <tr><td>-o</td> <td>导出的文件存储路径</td></tr> <tr><td>-q</td> <td>进行过滤</td></tr></tbody></table> <h3 id="_2-1-准备数据"><a href="#_2-1-准备数据" class="header-anchor">#</a> 2.1 准备数据</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">use</span> school<span class="token punctuation">;</span>
var students <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span>var i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span><span class="token number">10</span><span class="token punctuation">;</span>i<span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">)</span>{
students<span class="token punctuation">.</span>push<span class="token punctuation">(</span>{name:<span class="token string">'zfpx'</span><span class="token operator">+</span>i<span class="token punctuation">,</span>age:i}<span class="token punctuation">)</span><span class="token punctuation">;</span>
}
db<span class="token punctuation">.</span>students<span class="token punctuation">.</span><span class="token keyword">insert</span><span class="token punctuation">(</span>students<span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span>students<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_2-2-备份记录"><a href="#_2-2-备份记录" class="header-anchor">#</a> 2.2 备份记录</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mongoexport <span class="token operator">-</span>h <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span> <span class="token comment">--port 50000 -d school -c students -o stu.bak</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_2-3-删除记录"><a href="#_2-3-删除记录" class="header-anchor">#</a> 2.3 删除记录</h3> <blockquote><p>db.students.remove({});
WriteResult({ &quot;nRemoved&quot; : 10 })</p></blockquote> <h3 id="_2-4-导入记录"><a href="#_2-4-导入记录" class="header-anchor">#</a> 2.4 导入记录</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mongoimport <span class="token comment">--port 50000 --db school --collection students --file</span>
stu<span class="token punctuation">.</span>bak
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="_3-备份与恢复"><a href="#_3-备份与恢复" class="header-anchor">#</a> 3. 备份与恢复</h2> <h3 id="_3-1-mongodump"><a href="#_3-1-mongodump" class="header-anchor">#</a> 3.1 mongodump</h3> <ul><li>在 Mongodb 中我们使用 mongodump 命令来备份 MongoDB 数据。该命令可以导出所有数据到指定目录中。</li> <li>mongodump -h dbhost -d dbname -o dbdirectory</li> <li>-h MongDB 所在服务器地址，例如：127.0.0.1，当然也可以指定端口号：127.0.0.1:27017</li> <li>-d 需要备份的数据库实例，例如：test</li> <li>-o 备份的数据存放位置</li> <li>mongodump -d school -o data.dmp</li></ul> <h3 id="_3-2-mongorestore"><a href="#_3-2-mongorestore" class="header-anchor">#</a> 3.2 mongorestore</h3> <p>mongodb 使用 mongorestore 命令来恢复备份的数据。</p> <ul><li>--host MongoDB 所在服务器地址</li> <li>--db -d 需要恢复的数据库实例</li> <li>最后的一个参数，设置备份数据所在位置</li> <li>mongorestore data.dmp</li> <li>mongorestore -d school data.bmp/school</li> <li>Mongodump 可以 backup 整个数据库，而 mongoexport 要对每个 collection 进行操作，最主要的区别也是选择的标准是 mongoexport 输出的 JSON 比 Mongodump 的 BSON 可读性更高，进而可以直接对 JSON 文件进行操作然后还原数据（BSON 转换 JSON 存在潜在兼容问题）。</li></ul> <h2 id="_4-直接拷贝数据"><a href="#_4-直接拷贝数据" class="header-anchor">#</a> 4. 直接拷贝数据</h2> <h2 id="_5-锁定和解锁数据库"><a href="#_5-锁定和解锁数据库" class="header-anchor">#</a> 5. 锁定和解锁数据库</h2> <p>为了数据的完整性和一致性，导出前要先锁定写入，导出后再解锁。</p> <blockquote><p>use admin;
switched to db admin
db.runCommand({fsync:1,lock:1});
{</p></blockquote> <div class="language- extra-class"><pre><code>    &quot;info&quot; : &quot;now locked against writes, use db.fsyncUnlock() to unlock&quot;,
    &quot;seeAlso&quot; : &quot;http://dochub.mongodb.org/core/fsynccommand&quot;,
    &quot;ok&quot; : 1
</code></pre></div><p>}</p> <blockquote><p>db.fsyncUnlock();
{ &quot;ok&quot; : 1, &quot;info&quot; : &quot;unlock completed&quot; }</p></blockquote> <h2 id="_6-安全措施"><a href="#_6-安全措施" class="header-anchor">#</a> 6. 安全措施</h2> <ul><li>物理隔离</li> <li>网络隔离</li> <li>防火墙(IP/IP 段/白名单/黑名单)</li> <li>用户名和密码验证</li></ul> <h3 id="_6-1-用户管理"><a href="#_6-1-用户管理" class="header-anchor">#</a> 6.1 用户管理</h3> <h4 id="_6-1-1-查看角色"><a href="#_6-1-1-查看角色" class="header-anchor">#</a> 6.1.1 查看角色</h4> <p>show roles;
内置角色</p> <p>数据库用户角色：read、readWrite；
数据库管理角色：dbAdmin、dbOwner、userAdmin;
集群管理角色：clusterAdmin、clusterManager、clusterMonitor、hostManage；
备份恢复角色：backup、restore；
所有数据库角色：readAnyDatabase、readWriteAnyDatabase、userAdminAnyDatabase、dbAdminAnyDatabase
超级用户角色：root
内部角色：__system</p> <h4 id="_6-1-2-老的创建用户的方法"><a href="#_6-1-2-老的创建用户的方法" class="header-anchor">#</a> 6.1.2 老的创建用户的方法</h4> <blockquote><p>db.addUser('zfpx','123456');
WARNING: The 'addUser' shell helper is DEPRECATED. Please use 'createUser' inste
ad
Successfully added user: { &quot;user&quot; : &quot;zfpx&quot;, &quot;roles&quot; : [ &quot;root&quot; ] }
show roles;</p></blockquote> <h4 id="_6-1-3-新的创建用户的方法"><a href="#_6-1-3-新的创建用户的方法" class="header-anchor">#</a> 6.1.3 新的创建用户的方法</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>db<span class="token punctuation">.</span>createUser<span class="token punctuation">(</span>{
<span class="token keyword">user</span>:<span class="token string">&quot;zfpx2&quot;</span><span class="token punctuation">,</span>
pwd:<span class="token string">&quot;123456&quot;</span><span class="token punctuation">,</span>
roles:<span class="token punctuation">[</span>
{
role:<span class="token string">&quot;readWrite&quot;</span><span class="token punctuation">,</span>
db:<span class="token string">&quot;school&quot;</span>
}<span class="token punctuation">,</span>
<span class="token string">'read'</span>
<span class="token punctuation">]</span>
}<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><blockquote><p>db.createUser({user:'zfpx2',pwd:'123456',roles:[{role:'read',db:'school'}]});
Successfully added user: {</p></blockquote> <div class="language- extra-class"><pre><code>    &quot;user&quot; : &quot;zfpx2&quot;,
    &quot;roles&quot; : [
            {
                    &quot;role&quot; : &quot;read&quot;,
                    &quot;db&quot; : &quot;school&quot;
            }
    ]
</code></pre></div><p>}</p> <h4 id="_6-1-4-查看用户的权限"><a href="#_6-1-4-查看用户的权限" class="header-anchor">#</a> 6.1.4 查看用户的权限</h4> <blockquote><p>db.runCommand({usersInfo:'zfpx2',showPrivileges:true});
{</p></blockquote> <div class="language- extra-class"><pre><code>    &quot;users&quot; : [
            {
                    &quot;_id&quot; : &quot;admin.zfpx2&quot;,
                    &quot;user&quot; : &quot;zfpx2&quot;,
                    &quot;db&quot; : &quot;admin&quot;,
                    &quot;roles&quot; : [
                            {
                                    &quot;role&quot; : &quot;read&quot;,
                                    &quot;db&quot; : &quot;school&quot;
                            }
            ]
</code></pre></div><p>}</p> <h4 id="_6-1-5-服务器启动权限认证"><a href="#_6-1-5-服务器启动权限认证" class="header-anchor">#</a> 6.1.5 服务器启动权限认证</h4> <p>dbpath=E:\mongo\data
logpath=E:\mongo\log
port=50000
auth=true</p> <h4 id="_6-1-6-用户登录和修改密码"><a href="#_6-1-6-用户登录和修改密码" class="header-anchor">#</a> 6.1.6 用户登录和修改密码</h4> <blockquote><p>use admin;
use admin;
switched to db admin
db.auth('zfpx','123456')
1
db.changeUserPassword('zfpx','123');
db.auth('zfpx','123')
1</p></blockquote> <h4 id="_6-1-7-修改个人信息"><a href="#_6-1-7-修改个人信息" class="header-anchor">#</a> 6.1.7 修改个人信息</h4> <p>db.runCommand({updateUser:'zfpx',pwd:'123', customData:{
name:'珠峰培训',
email:'zfpx@126.com',
age:18,
}});</p> <blockquote><p>db.runCommand({usersInfo:'zfpx',showPrivileges:true})
用户的操作都需要在 admin 数据库下面进行操作
如果在某个数据库下面执行操作，那么只对当前数据库生效
addUser 已经废弃，默认会创建 root 用户，不安全，不再建议使用</p></blockquote> <h2 id="_7-数据库高级命令"><a href="#_7-数据库高级命令" class="header-anchor">#</a> 7. 数据库高级命令</h2> <h3 id="_7-1-准备数据"><a href="#_7-1-准备数据" class="header-anchor">#</a> 7.1 准备数据</h3> <p>var students = [
{name:'zfpx1',home:'北京',age:1},
{name:'zfpx2',home:'北京',age:2},
{name:'zfpx3',home:'北京',age:3},
{name:'zfpx4',home:'广东',age:1},
{name:'zfpx5',home:'广东',age:2},
{name:'zfpx6',home:'广东',age:3}
]
db.students.insert(students);</p> <h3 id="_7-2-count"><a href="#_7-2-count" class="header-anchor">#</a> 7.2 count</h3> <p>查看记录数</p> <p>db.students.find().count();</p> <h3 id="_7-2-查找不重复的值-distinct"><a href="#_7-2-查找不重复的值-distinct" class="header-anchor">#</a> 7.2 查找不重复的值 distinct</h3> <p>db.runCommand({distinct:'students',key:'home'}).values;</p> <p>[ &quot;北京&quot;, &quot;广东&quot; ]</p> <h3 id="_7-3-group-分组"><a href="#_7-3-group-分组" class="header-anchor">#</a> 7.3 group 分组</h3> <p>db.runCommand({
group:{
ns:集合名称，
key:分组的键,
initial:初始值,
$reduce:分解器
condition:条件,
finalize:完成时的处理器
}
});</p> <h4 id="_7-3-1-按城市分组-求每个城市里符合条件的人的年龄总和"><a href="#_7-3-1-按城市分组-求每个城市里符合条件的人的年龄总和" class="header-anchor">#</a> 7.3.1 按城市分组，求每个城市里符合条件的人的年龄总和</h4> <p>db.runCommand({
group:{
ns:'students',
key:{home:true},
initial:{total:0},
$reduce:function(doc,result){
result.total += doc.age;<br>
},
condition:{age:{$gt:1}},
finalize:function(result){
result.desc = '本城市的总年龄为'+result.total;
}
}
});</p> <h3 id="_7-4-删除集合"><a href="#_7-4-删除集合" class="header-anchor">#</a> 7.4 删除集合</h3> <p>db.runCommand({drop:'students'});</p> <h3 id="_7-5-runcommand-常用命令"><a href="#_7-5-runcommand-常用命令" class="header-anchor">#</a> 7.5 runCommand 常用命令</h3> <p>db.runCommand({buildInfo:1});
db.runCommand({getLastError:&quot;students&quot;});
db.persons.insert({_id:1,name:1});
db.persons.insert({_id:1,name:1});
db.runCommand({getLastError:&quot;students&quot;});</p> <h2 id="_8-什么固定集合"><a href="#_8-什么固定集合" class="header-anchor">#</a> 8. 什么固定集合</h2> <p>MongoDB 固定集合（Capped Collections）是性能出色且有着固定大小的集合，对于大小固定，我们可以想象其就像一个环形队列，当集合空间用完后，再插入的元素就会覆盖最初始的头部的元素！ firstinfirstout</p> <h3 id="_8-1-特性"><a href="#_8-1-特性" class="header-anchor">#</a> 8.1 特性</h3> <p>没有索引
插入和查询速度速度非常快 不需要重新分配空间
特别适合存储日志</p> <h3 id="_8-2-创建固定集合"><a href="#_8-2-创建固定集合" class="header-anchor">#</a> 8.2 创建固定集合</h3> <p>我们通过 createCollection 来创建一个固定集合，且 capped 选项设置为 true：
还可以指定文档个数,加上 max:1000 属性：
判断集合是否为固定集合: db.logs.isCapped()
size 是整个集合空间大小，单位为【KB】
max 是集合文档个数上线，单位是【个】
如果空间大小到达上限，则插入下一个文档时，会覆盖第一个文档；如果文档个数到达上限，同样插入下一个文档时，会覆盖第一个文档。两个参数上限判断取的是【与】的逻辑。
capped 封顶的
db.createCollection('logs',{size:50,max:5,capped:true});</p> <h3 id="_8-3-非固定集合转为固定集合"><a href="#_8-3-非固定集合转为固定集合" class="header-anchor">#</a> 8.3 非固定集合转为固定集合</h3> <p>db.runCommand({convertToCapped:&quot;logs&quot;,size:5});</p> <h2 id="_9-gridfs"><a href="#_9-gridfs" class="header-anchor">#</a> 9. gridfs</h2> <p>gridfs 是 mongodb 自带的文件系统，使用二进制存储文件。
mongodb 可以以 BSON 格式保存二进制对象。
但是 BSON 对象的体积不能超过 4M。所以 mongodb 提供了 mongofiles。它可以把一个大文件透明地分割成小文件（256K），从而保存大体积的数据。
GridFS 用于存储和恢复那些超过 16M（BSON 文件限制）的文件(如：图片、音频、视频等)。
GridFS 用两个集合来存储一个文件：fs.files 与 fs.chunks。
每个文件的实际内容被存在 chunks(二进制数据)中,和文件有关的 meta 数据(filename,content_type,还有用户自定义的属性)将会被存在 files 集合中。</p> <h3 id="_9-1-上传一个文件"><a href="#_9-1-上传一个文件" class="header-anchor">#</a> 9.1 上传一个文件</h3> <p>-d 数据库的名称
-l 源文件的位置
put 指定文件名
mongofiles -d myfiles put test.txt</p> <h3 id="_9-2-获取并下载文件"><a href="#_9-2-获取并下载文件" class="header-anchor">#</a> 9.2 获取并下载文件</h3> <p>mongofiles -d myfiles get 'test.txt'</p> <h3 id="_9-3-查看所有文件"><a href="#_9-3-查看所有文件" class="header-anchor">#</a> 9.3 查看所有文件</h3> <p>mongofiles -d myfiles list</p> <blockquote><p>db.fs.files.find()
db.fs.chunks.find({files_id:ObjectId('')})</p></blockquote> <h3 id="_9-4-删除文件"><a href="#_9-4-删除文件" class="header-anchor">#</a> 9.4 删除文件</h3> <p>mongofiles -d myfiles delete &quot;test.txt&quot;</p> <h3 id="_9-5-eval-服务器端脚本"><a href="#_9-5-eval-服务器端脚本" class="header-anchor">#</a> 9.5 eval 服务器端脚本</h3> <p>执行 JS 语句
定义 JS 全局变量
定义函数
Stored JavaScript
db.eval(&quot;1+1&quot;);
db.eval(&quot;return 'hello'&quot;);
db.system.js.insert({_id:&quot;x&quot;,value:1});
db.eval(&quot;return x&quot;);
db.system.js.insert({_id:&quot;say&quot;,value:function(){return 'hello'}});
db.eval(&quot;say()&quot;);</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/zhoubichuan/web-mongodb/edit/master/src/base/build/11.data.md" target="_blank" rel="noopener noreferrer">在github上编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/7/5 16:16:24</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/web-mongodb/base/build/10.ui.html" class="prev">
          基础知识
        </a></span> <span class="next"><a href="/web-mongodb/base/build/12.skill.html">
          基础3
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/web-mongodb/assets/js/app.d4f4e3a2.js" defer></script><script src="/web-mongodb/assets/js/2.5fc4c12c.js" defer></script><script src="/web-mongodb/assets/js/11.b75e87f0.js" defer></script><script src="/web-mongodb/assets/js/3.7af90dcf.js" defer></script>
  </body>
</html>
